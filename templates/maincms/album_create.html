{% extends 'maincms_base.html' %}
{% block content %}
{% include "maincms/navbar.html" %}

<!-- 앨범 정보 상자 -->
<div class="container-lg my-4 py-3">
    <h5 class="fw-bold">앨범 정보</h5>
    <div class="info-field mb-5" id="album_info">
        <div class="info-field-column" style="width: 320px;">
            <div id="cover-box">
                <p>앨범 커버 업로드</p>
            </div>
        </div>
        <div class="info-field-column left-auto">
            <div class="info-field">
                <div class="label-field"><i class="bi bi-check check"></i>앨범명(국문)</div><input class="form-in" type="text" name="album_title">
                <div class="label-field"><i class="bi bi-check"></i>앨범명(영문)</div><input class="form-in" type="text" name="album_title_en">
            </div>
            <div class="info-field">
                <div class="label-field"><i class="bi bi-check check"></i>아티스트</div><input class="form-in" type="text" id="album_artist" name="album_artist">
                <div class="label-field"><i class="bi bi-check check"></i>앨범장르</div>
                <select class="form-select-sm" id="album_genre" name="album_genre" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="POP">POP</option>
                    <option value="Dance">Dance</option>
                    <option value="Hiphop">Hiphop</option>
                    <option value="Newage">Newage</option>
                    <option value="Indie pop">Indie pop</option>
                    <option value="Indie">Indie</option>
                    <option value="Indie Rock">Indie Rock</option>
                    <option value="Indie Folk">Indie Folk</option>
                    <option value="Folk">Folk</option>
                    <option value="World">World</option>
                    <option value="OST">OST</option>
                    <option value="Trot">Trot</option>
                    <option value="Instrumental">Instrumental</option>
                </select>
            </div>
            <div class="info-field">
                <div class="label-field"><i class="bi bi-check check"></i>앨범유형</div>
                <select class="form-select-sm" name="album_Categ" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="싱글">싱글</td>
                    <option value="EP">EP</td>
                    <option value="정규">정규</td>
                    <option value="OST">OST</td>
                </select>
                <div class="label-field"><i class="bi bi-check check"></i>발매국가</div>
                <select class="form-select-sm" name="album_country" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="Korea">한국</option>
                    <option value="USA">미국</option>
                    <option value="Jepan">일본</option>
                </select>
            </div>
            <div class="info-field">
                <div class="label-field"><i class="bi bi-check"></i>UPC</div><input class="form-in" type="text" name="UPC">
                <div class="label-field"><i class="bi bi-check"></i>UCI</div><input class="form-in" type="text" name="UCI">
            </div>
            <div class="info-field">
                <div class="label-field"><i class="bi bi-check check"></i>기획사</div><input class="form-in" type="text" name="album_copyright">
                <div class="label-field"><i class="bi bi-check check"></i>유통사</div><input class="form-in" type="text" name="album_publish">
            </div>
            <div class="info-field">
                <div class="label-field"><i class="bi bi-check check"></i>발매일</div><input class="form-in datepicker" type="text" name="startdate" style="width: 203px;">
                <div class="label-field"><i class="bi bi-check check"></i>오픈일</div><input class="form-in datepicker" id="opendate" type="text" name="opendate" style="width: 203px;">
            </div>
        </div>
    </div>
    <h5 class="fw-bold">권리자 정보</h5>
    <div class="info-field mb-5" id="user_info">
        <div class="label-field"><i class="bi bi-check check"></i>권리자 찾기</div><input class="form-in" type="text" name="right_holder"><div class="label-field"><i class="bi bi-check check"></i>권리자 ID</div><input class="form-in" type="text" name="right_holder_id">
        <div class="label-field"><i class="bi bi-check check"></i>정산 수수료율</div><input class="form-in" type="text" name="allocation_rate">
    </div>
    <h5 class="fw-bold">서비스 정보 및 옵션</h5>
    <div class="info-field mb-5" id="service_option">
        <div class="info-field-column">
            <div class="info-field">               
                <div class="label-field"><i class="bi bi-check check"></i>서비스 영역</div>
                <select class="form-select-sm" name="service_area" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="WW">전세계</option>
                    <option value="국내">국내</option>
                    <option value="해외">해외</option>
                </select>
            </div>
            <div class="info-field"><div class="label-field"><i class="bi bi-check"></i>제외 국가</div><input class="form-in" type="text" name="excluded"></div>
            <div class="info-field">               
                <div class="label-field"><i class="bi bi-check check"></i>Youtube 서비스</div>
                <select class="form-select-sm" name="YT_service" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="AT+CID">AT+CID</option>
                    <option value="AT_Only">AT_Only</option>
                </select>
            </div>
        </div>
        <div class="info-field-column">
            <div class="info-field">               
                <div class="label-field"><i class="bi bi-check check"></i>서비스 언어</div>
                <select class="form-select-sm" name="service_lang" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="한국어">한국어</option>
                    <option value="영어">영어</option>
                    <option value="일본어">일본어</option>
                </select>
            </div>
            <div class="info-field">               
                <div class="label-field"><i class="bi bi-check check"></i>서비스 시간</div>
                <select class="form-select-sm" name="service_time" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="12:00">12:00</option>
                    <option value="18:00">18:00</option>
                </select>
            </div>
            <div class="info-field">               
                <div class="label-field"><i class="bi bi-check"></i>프로모션 유무</div>
                <select class="form-select-sm" name="promotion" style="width: 203px;">
                    <option selected>선택하세요</option>
                    <option value="Y">Y</option>
                    <option value="N">N</option>
                </select>
            </div>
        </div>
        <div class="info-field-column">
            <a class="btn btn-outline-primary btn-sm my-1" id="setdateButton" role="button" style="width: 150px;">발매일 동기화</a>
            <a class="btn btn-outline-primary btn-sm my-1" id="setgenreButton" role="button" style="width: 150px;">장르 동기화</a>
            <a class="btn btn-outline-primary btn-sm my-1" id="setArtistButton" role="button" style="width: 150px;">곡 아티스트 동기화</a>
        </div>
        <div class="info-field-column">
            <a class="btn btn-outline-primary btn-sm my-1" href="#" style="width: 150px;">UPC 발급</a>
            <a class="btn btn-outline-primary btn-sm my-1" href="#" style="width: 150px;">기획사 동기화</a>
            <a class="btn btn-outline-primary btn-sm my-1" href="#" style="width: 150px;">UCI 발급</a>
        </div>
    </div>
    <h5 class="fw-bold">디스크 / 트랙 정보</h5>
    <div class="info-field mb-5" id="service_option">
        <div class="label-field"><i class="bi bi-check check"></i>디스크 수</div><input class="form-ck" type="text" id="disc_total_num" style="width: 31px;" value="1">
        <div class="label-field"><i class="bi bi-check check"></i>트랙 수</div><input class="form-ck" type="text" id="track_total_num" style="width: 31px;" value="1">
        <a class="btn btn-primary btn-sm my-1" role="button" id="generate" style="margin-left: 30px;">디스크 만들기</a>
    </div>
    <table class="table" id="result-table">
        <thead class="table-light">
            <tr>
            <th scope="col-1" class="text-center" style="width:50px;">DISK</th>
            <th scope="col-1" class="text-center" style="width:50px;">NO.</th>
            <th scope="col" class="text-center">Song title</th>
            <th scope="col" class="text-center"style="width:400px;">Artist</th>
            <th scope="col" class="text-center" style="width:100px;">상세보기</th>
            </tr>
        </thead>
        <!-- 반복 규정된 테이블 -->
        <tbody id="1_1">
            <tr>
                <th class='text-center' ><input class="form-ck" type="number" id="disk_no_1" name="disk_no[]" style="width: 31px;"></div></th>
                <th class='text-center' ><input class="form-ck" type="number" id="track_no_1" name="track_no[]" style="width: 31px;"></div></th>
                <th class='text-center' id="song_title_view_1_1"></th>
                <th class='text-center' id="artist_view_1_1"></th>
                <th class='text-center'><i class="bi bi-chevron-up icon" data-target="1_1_detail"></i></td>
            </tr>
            <tr id="detail_1_1">
                <th colspan='3'>
                    <div class="info-field">
                        <div class="info-field-column">
                            <div class="info-field">
                                <div class="label-field"><i class="bi bi-check check"></i>곡 제목</div><input class="form-tr song-title" type="text" name="song_title[]"  data-target="song_title_view_1_1">
                                <div class="label-field"><i class="bi bi-check check"></i>곡 아티스트</div><input class="form-tr song-artist" type="text" name="song_artist[]" data-target="artist_view_1_1">
                            </div>
                            <div class="info-field">
                                <div class="label-field"><i class="bi bi-check check"></i>트랙 장르</div>                
                                <select class="form-select-sm track_genre" name="track_genre[]" style="width: 203px;">
                                    <option selected>선택하세요</option>
                                    {% for g in genre_list %}
                                    <option value="{{ g.genres }}">{{ g.genres }}</td>
                                    {% endfor %}
                                </select>
                                <div class="label-field"><i class="bi bi-check check"></i>서비스 언어</div>
                                <select class="form-select-sm" name="track_lang[]" style="width: 203px;">
                                    <option selected>선택하세요</option>
                                    <option value="한국어">한국어</option>
                                    <option value="영어">영어</option>
                                    <option value="일본어">일본어</option>
                                </select>
                            </div>
                            <div class="info-field">
                                <div class="label-field"><i class="bi bi-check check"></i>오픈일</div><input class="form-tr datepicker" type="text" name="tr_opendate[]">
                                <div class="label-field"><i class="bi bi-check check"></i>ISRC</div><input class="form-tr" type="text" name="isrc[]">
                            </div>
                            <div class="info-field jf-item">
                                <div class="label-field lab-sm"><i class="bi bi-check"></i>대표곡</div><input class="form-check-input" type="checkbox" value="" name="title_song[]">
                                <div class="label-field lab-sm"><i class="bi bi-check"></i>성인</div><input class="form-check-input" type="checkbox" value="" name="adult[]">
                            </div>
                            <div class="info-field">
                                <div class="label-field lab"><i class="bi bi-check check"></i>음원추가</div><input class="form-control form-control-sm song_file" id="song_file[]" type="file" style="width:250px;"><input class="form-tr track_length" type="text" name="track_length[]"style="width:80px;"><input class="form-control form-control-sm" id="lyric_file[]" type="file"style="width:230px;">
                            </div>
                        </div>
                    </div>
                </th>
                <th>
                    <div class="info-field-column jf-item">
                        <div class="info-field"><div class="label-field"><i class="bi bi-check"></i>작사가</div><input class="form-control form-control-sm col" type="text" name="lyricist[]"></div>
                        <div class="info-field"><div class="label-field"><i class="bi bi-check check"></i>작곡가</div><input class="form-control form-control-sm col" type="text" name="composer[]"></div>
                        <div class="info-field"><div class="label-field"><i class="bi bi-check check"></i>편곡가</div><input class="form-control form-control-sm col" type="text" name="arranger[]"></div>
                        <div class="info-field"><div class="label-field"><i class="bi bi-check"></i>참여아티스트</div><input class="form-control form-control-sm col" type="text" name="with_artist[]"></div>
                        <div class="info-field"><div class="label-field"><i class="bi bi-check"></i>피쳐링아티스트</div><input class="form-control form-control-sm col" type="text" name="featured[]"></div>
                    </div>
                </th>
                <th class="text-center">
                    <div class="info-field-column">
                        <a class='btn btn-danger btn-sm'>트랙 삭제</a>
                    </div>
                </th>
            </tr>
        </tbody>
    </table>
    <div class="info-field"><button class="btn btn-primary" type="submit" id="album_add">등록하기</button></div>
</div>
<!-- 아티스트 검색 모달-->
<div class="af_modal" id="aritst_find">
    <div class="af_modal-content">
<div class="container-lg py-3">
    {% csrf_token %}
    <h5 class="fw-bold mb-2">아티스트 검색</h5>
        <input type="text" id="search-input" name="q" class="form-tr" placeholder="아티스트 이름 검색"
               value="">
        <button type="submit" class="btn btn-primary btn-sm">검색</button>
    <h5 class="fw-bold mb-2">아티스트 리스트</h5>
    <table id="ar_fi_table">
        <thead class="table-light">
            <tr>
            <th scope="col-1" class="text-center" style="width:50px;">NO.</th>
            <th scope="col" class="text-center">Artist Image</th>
            <th scope="col" class="text-center">Artist ID</th>
            <th scope="col" class="text-center">Artist_name</th>
            <th scope="col" class="text-center">category</th>
            </tr>
        </thead>
        <tbody class="tbody">
            <tr style="font-size: 13px;">
                <td class="text-center">{{ forloop.counter }}</td>
                <td class="text-center">
                    {% if Artists.Artist_image %}
                    <img src="http://localhost:8000/media/{{ Artists.Artist_image }}" style="width: 30px;" height="30px;">
                    {% else %}
                    <img src="http://localhost:8000/media/Artist_images/user_image_none.png" style="width: 30px;" height="30px;">
                    {% endif %}
                </td>
                <td class="text-center">{{ Artists.Artist_ID }}</td>
                <td class="text-center">{{ Artists.Artist_name }}</td>
                <td class="text-center">{{ Artists.category }}</td>
            </tr>
        </tbody>
     </table>
        <a href="{% url 'maincms:create_artist' %}" class="btn btn-primary">등록하기</a>
</div>
      <button class="close-btn" id="closeModalBtn">Close</button>
    </div>
</div>
<script>
$(document).ready(function () {
    $(".icon").click(function () {
        // 아이콘 회전 및 색상 변경
        $(this).toggleClass("rotated");

        // data-target 속성에서 연결된 tr의 ID 가져오기
        const targetId = $(this).data("target");

        // 해당 ID를 가진 tr 표시/숨김 처리
        $("#" + targetId).toggleClass("hidden-row");
    });
});
</script>

<script>
$(document).ready(function () {
    $("#setgenreButton").on("click", function (e) {
                e.preventDefault();
                const syncValue = $("#album_genre").val(); // 외부 입력된 값
                $(".track_genre").each(function () {
                    $(this).val(syncValue); // 입력 값 설정
                    const targetId = $(this).data("target");
                    $("#" + targetId).text(syncValue); // 상위 값 갱신
            });
    });
    $("#setdateButton").on("click", function (e) {
                e.preventDefault();
                const syncValue = $("#opendate").val(); // 외부 입력된 값
                $(".datepicker").each(function () {
                    $(this).val(syncValue); // 입력 값 설정
                    const targetId = $(this).data("target");
                    $("#" + targetId).text(syncValue); // 상위 값 갱신
            });
    });
                // 동기화 버튼 클릭 시 모든 song_artist[]에 값 적용
    $("#setArtistButton").on("click", function (e) {
                e.preventDefault();
                const syncValue = $("#album_artist").val(); // 외부 입력된 값
                $(".song-artist").each(function () {
                    $(this).val(syncValue); // 입력 값 설정
                    const targetId = $(this).data("target");
                    $("#" + targetId).text(syncValue); // 상위 값 갱신
            });
    });
});
</script>
<script>
    $(document).on('click', '.datepicker', function() {
        $(this).datepicker({
		    format: "yyyy-mm-dd",	//데이터 포맷 형식(yyyy : 년 mm : 월 dd : 일 )
		    //startDate: '-10d',	//달력에서 선택 할 수 있는 가장 빠른 날짜. 이전으로는 선택 불가능 ( d : 일 m : 달 y : 년 w : 주)
		    //endDate: '+10d',	//달력에서 선택 할 수 있는 가장 느린 날짜. 이후로 선택 불가 ( d : 일 m : 달 y : 년 w : 주)
		    autoclose : true,	//사용자가 날짜를 클릭하면 자동 캘린더가 닫히는 옵션
		    calendarWeeks : false, //캘린더 옆에 몇 주차인지 보여주는 옵션 기본값 false 보여주려면 true
		    clearBtn : false, //날짜 선택한 값 초기화 해주는 버튼 보여주는 옵션 기본값 false 보여주려면 true
		    //datesDisabled : ['2019-06-24','2019-06-26'],//선택 불가능한 일 설정 하는 배열 위에 있는 format 과 형식이 같아야함.
		    disableTouchKeyboard : false,	//모바일에서 플러그인 작동 여부 기본값 false 가 작동 true가 작동 안함.
		    immediateUpdates: false,	//사용자가 보는 화면으로 바로바로 날짜를 변경할지 여부 기본값 :false 
		    multidate : false, //여러 날짜 선택할 수 있게 하는 옵션 기본값 :false 
		    templates : {
		        leftArrow: '&laquo;',
		        rightArrow: '&raquo;'
		    }, //다음달 이전달로 넘어가는 화살표 모양 커스텀 마이징 
		    showWeekDays : true ,// 위에 요일 보여주는 옵션 기본값 : true
		    todayHighlight : true ,	//오늘 날짜에 하이라이팅 기능 기본값 :false 
		    toggleActive : true,	//이미 선택된 날짜 선택하면 기본값 : false인경우 그대로 유지 true인 경우 날짜 삭제
		    weekStart : 0 ,//달력 시작 요일 선택하는 것 기본값은 0인 일요일 
		    language : "ko"	//달력의 언어 선택, 그에 맞는 js로 교체해줘야한다.
		    
		}).datepicker('show');
	});//ready end
</script>
<script>

</script>
<script>
$("#album_add").click(function() {
    const formData = new FormData();
    formData.append('album_title',$("input[name='album_title']").val());
    formData.append('album_title_en',$("input[name='album_title_en']").val());
    formData.append('album_artist',$("input[name='album_artist']").val());
    formData.append('album_genre',$("input[name='album_genre']").val());
    formData.append('album_Categ',$("input[name='album_Categ']").val());
    formData.append('album_country',$("input[name='album_country']").val());
    formData.append('startdate',$("input[name='startdate']").val());
    formData.append('opendate',$("input[name='opendate']").val());
    formData.append('service_time',$("input[name='service_time']").val());
    formData.append('album_copyright',$("input[name='album_copyright']").val());
    formData.append('album_publish',$("input[name='album_publish']").val());
    formData.append('service_area',$("input[name='service_area']").val());
    formData.append('excluded',$("input[name='excluded']").val());
    formData.append('service_lang',$("input[name='service_lang']").val());
    formData.append('UPC',$("input[name='UPC']").val());
    formData.append('UCI',$("input[name='UCI']").val());
    formData.append('YT_service',$("input[name='YT_service']").val());
    formData.append('status','등록');

        // FormData의 내용을 출력하기
    for (let pair of formData.entries()) {
        console.log(pair[0] + ': ' + pair[5]);
    }

  });
</script>

{% endblock %}